# The ultimate CrossCode type definitions

Hi! This document serves as the documentation for the _Ultimate CrossCode TypeDefs_ project and programmer's guide to writing CrossCode mods in [TypeScript](https://www.typescriptlang.org/).

## History and background

When I began working on this project ([March 31st](https://github.com/dmitmel/crosscode-ru/commit/8c236560a6a148a909730b846f640d74fdde2c07)) I was very surprised that there hadn't been many existing mods written in TypeScript. Yes, some of the tools have been written in TS since the ancient ages - [crosscode-map-editor](https://github.com/CCDirectLink/crosscode-map-editor/) has been around for almost three years now, work on the [ccbot2](https://github.com/CCDirectLink/ccbot-backup) project, which is a TypeScript rewrite of the original ccbot, has been started a year ago. However, I'm not talking about projects which don't interact with a big existing codebase, mods in other words. No no no, I'm talking about programs written in TypeScript as an extension to a gigantic CrossCode codebase which doesn't provide any concrete type information whatsoever.

In fact, of all the repositories I found there were just three TS mods back then - [CCDirectLink's Multiplayer client](https://github.com/CCDirectLink/CCMultiplayerClient) (there are multiple multiplayer implementations), [2767mr's CCTAS](https://github.com/2767mr/CCTAS) (yes, there are multiple TAS implementations) and [Item spawner](https://github.com/CCDirectLink/CC-ItemSpawner). However, Item spawner doesn't really count because its game-facing code is written in JS and the parts written in TS only interact with the GUI which is an HTML page created in a separate window. [CCTypings](https://github.com/CCDirectLink/CCTypings) existed back then, however, in a [much more rudimentary state](https://github.com/CCDirectLink/CCTypings/tree/24fcc1cfb323f69f97f6f42418d48c4801c0e535). It also became known that 2767mr had written a better analyzer for CCTypings, but didn't publish it to GitHub back then (it is now available in the repository).

This project was first devised to be a part of [crosscode-ru](https://github.com/dmitmel/crosscode-ru). It was initially developed to **typecheck all of the crosscode-ru codebase with TypeScript**, which forced me to engineer a rather sophisticated type definitions for [Impact's OOP system](https://impactjs.com/documentation/class-reference/class) (because cc-ru makes use of some of its quite unique features, apart from `staticInstantiate`. I haven't gotten to implementing it yet, so TODO), helped me find and eliminate various limitations of the typedefs during development and resulted in extensive (in my opinion) definitions for the core GUI classes. In my eyes I have successfully reached ~~Steins Gate~~ the initial goal, i.e. typechecking 100% of crosscode-ru, and now I can safely say that the idea of rewriting everything needed for operation of cc-ru (Localize Me, CCLoader etc) in TypeScript (with as less `any` and unsafe type casts through `as unknown` as possible) is, in fact, possible.

Sometime after the v1.0 release of crosscode-ru (after v1.0.4 IIRC) I began working on other mods which I also fully cover with typechecking, most notably [Readable saves](https://github.com/dmitmel/crosscode-readable-saves), so I moved this project out of the cc-ru source tree, albeit the commits made during the initial development of the ultimate typedefs [still remain in the cc-ru repository](https://github.com/dmitmel/crosscode-ru/compare/8c236560a6a148a909730b846f640d74fdde2c07..623d2ee7b9d4ad598ae88c3874a5f19b26c65218). **Unfortunately, this project isn't at the stage when I can safely call it production-ready and usable in day-to-day modding**, the type coverage is incredibly small compared to the full CrossCode codebase, as such porting existing mods is required to advance analysis of types used in the CC codebase. **It would be a great help nevertheless if you rewrite your mods and add accompanying type definitions to this repository!**

## Comparison with [CCTypings](https://github.com/CCDirectLink/CCTypings)

**CCTypings** is a project with a similar idea to **ultimate-crosscode-typedefs**, although there are a few key differences. First of all, ultimate-crosscode-typedefs is developed by me, dmitmel, whereas CCTypings is developed by 2767mr. Although CCTypings was created a year ago now, and the development of ultimate-crosscode-typedefs began a month and a half ago, the latter has been more active in the recent times, of course. The most notable difference is that **CCTypings is focused on speeding up the development of CC mods** by providing the largest symbol coverage possible, in other words listings of all existing classes, properties, fields, methods, namespaces etc, **whereas ultimate-crosscode-typedefs is focused on improving the correctness of the mod code** by providing the ability to typecheck the code as formally as possible, in other words without the use of escape hatches like `any` and `as unknown` casts. Because ultimate-crosscode-typedefs is interested in formal correctness, it isn't suitable for prototyping (i.e. trying out an idea), at least right now. **Another key difference is that CCTypings is automatically generated, on the other hand ultimate-crosscode-typedefs is written manually**. I have to note though that during the recent week (as of writing this paragraph) 2767mr developed a [Portal-like mod](https://github.com/CCDirectLink/CCPortal) which uses CCTypings, so I'm really interested in whether we can share the progress between two projects and maybe combine them.

## Why this project is important

Firstly, the obvious benefits of using a statically-typed language apply, I doubt I have to explain that because you've probably found this project by looking for how to use TypeScript for CC modding. I have to note that these benefits are real - they helped me find a few critical bugs and simplified refactoring various aspects of crosscode-ru. The availability of types also made mod programming more enjoyable (for me at least), so I consider this a win even despite the time and effort needed for writing the type definitions in the first place.

The most important benefit of this project is that it forces analysis and reverse-engineering of the CrossCode codebase, which is arguably very good, and not only that, now we can formally describe purposes of various components of CC and relations between them. I hope that one day we can reach the world line when [crosscode-re-docs](https://github.com/CCDirectLink/crosscode-re-docs) is embedded into the `.d.ts` files and is available in the documentation window of VS Code!
